<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tibor Pál — Academic Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    canvas {
      max-width: 800px;
      margin: 20px auto;
      display: block;
    }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h1>TIBOR PÁL</h1>
      <nav>
        <a href="#" onclick="showSection('about'); return false;">ABOUT</a>
        <a href="#" onclick="showSection('research'); return false;">RESEARCH INTEREST</a>
        <a href="#" onclick="showSection('publications'); return false;">PUBLICATIONS</a>
        <a href="#" onclick="showSection('results'); return false;">RESULTS</a>
      </nav>
    </aside>

    <main class="content">
      <section id="about" class="section active">
        <h2>ABOUT</h2>
        <p>
          <img src="profile_tibor-pal.jpeg" alt="Tibor Pál" class="profile-photo" />
          Tibor Pál is a PhD candidate in Statistical Methods in Economics at the University of Salerno, specializing in Score-Driven Models, State-Space Models, Kalman Filter, and Volatility Modeling.
        </p>
        <div class="about-links">
          <a href="your_cv_link_here.pdf" target="_blank">CV</a> /
          <a href="https://www.linkedin.com/in/tibor-pal11/" target="_blank">LinkedIn</a>
        </div>
      </section>

      <section id="research" class="section">
        <h2>RESEARCH INTERESTS</h2>
        <p>State Space Models, Kalman Filter, and Volatility Modeling.</p>
      </section>

      <section id="publications" class="section">
        <h2>PUBLICATIONS</h2>
        <ul>
          <li><a href="papers/paper1.pdf">Monetary policy models: lessons from the Eurozone crisis</a></li>
        </ul>
      </section>

      <section id="results" class="section">
        <h2>RESULTS</h2>
        <canvas id="timeChart" width="800" height="400"></canvas>
      </section>
    </main>
  </div>

  <footer>
    <p>&copy; 2025 Tibor Pál</p>
  </footer>

<script>
  const startYear = 1961, endYear = 2024;

  const recessions = [
    { start: new Date(1973, 10, 1), end: new Date(1975, 3, 1) },
    { start: new Date(1980, 0, 1), end: new Date(1980, 6, 1) },
    { start: new Date(1981, 6, 1), end: new Date(1982, 10, 1) },
    { start: new Date(1990, 6, 1), end: new Date(1991, 2, 1) },
    { start: new Date(2001, 2, 1), end: new Date(2001, 10, 1) },
    { start: new Date(2007, 11, 1), end: new Date(2009, 5, 1) },
    { start: new Date(2020, 1, 1), end: new Date(2020, 6, 1) }
  ];

  const recessionPlugin = {
    id: 'recessionPlugin',
    beforeDatasetsDraw(chart) {
      const { ctx, chartArea: { top, bottom }, scales: { x } } = chart;
      ctx.save();
      ctx.fillStyle = 'rgba(200, 0, 0, 0.1)';
      recessions.forEach(({ start, end }) => {
        const xStart = x.getPixelForValue(start);
        const xEnd = x.getPixelForValue(end);
        ctx.fillRect(xStart, top, xEnd - xStart, bottom - top);
      });
      ctx.restore();
    }
  };

  let timeChart = null;

  async function fetchAndParseExcel() {
    try {
      const response = await fetch('results_PS2025.xlsx');
      if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

      const arrayBuffer = await response.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, { type: 'array' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const json = XLSX.utils.sheet_to_json(worksheet);

      // Convert to chart format: {x: Date, y: Number}
      function excelDateToJSDate(serial) {
        // Excel serial to JS Date
        const utc_days = serial - 25569;
        const utc_value = utc_days * 86400;
        return new Date(utc_value * 1000);
      }

      const parsed_rStar = json.map(row => {
        let date = row.Date;
        if (typeof date === 'number') {
          date = excelDateToJSDate(date);
        } else {
          // Date might be a string like "01/01/1961"
          date = new Date(date);
        }
        return { x: date, y: row.rStar };
      });

      const parsed_rStar_sm = json.map(row => {
        let date = row.Date;
        if (typeof date === 'number') {
          date = excelDateToJSDate(date);
        } else {
          date = new Date(date);
        }
        return { x: date, y: row.rStar_sm };
      });

      return { parsed_rStar, parsed_rStar_sm };
    } catch (error) {
      console.error('Error loading Excel file:', error);
      return null;
    }
  }

  async function createChart() {
    const ctx = document.getElementById('timeChart').getContext('2d');
    const data = await fetchAndParseExcel();

    if (!data) {
      // If fail, show an empty chart or default data
      console.warn('No data loaded, showing empty chart.');
      timeChart = new Chart(ctx, {
        type: 'line',
        data: { datasets: [] },
        options: {}
      });
      return;
    }

    timeChart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: [
          {
            label: 'rStar',
            data: data.parsed_rStar,
            borderColor: '#0072BD',
            borderWidth: 2,
            fill: false,
            tension: 0.1,
            pointRadius: 0
          },
          {
            label: 'rStar_sm',
            data: data.parsed_rStar_sm,
            borderColor: '#177245',
            borderWidth: 2,
            fill: false,
            tension: 0.1,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            type: 'time',
            time: {
              unit: 'year',
              stepSize: 5,
              displayFormats: { year: 'yyyy' }
            },
            title: { display: true, text: 'Year', font: { size: 16 } },
            ticks: { font: { size: 14 }, maxRotation: 0, autoSkip: true },
            min: new Date(startYear, 0, 1),
            max: new Date(endYear, 11, 31)
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Percent', font: { size: 16 } },
            ticks: { font: { size: 14 } }
          }
        },
        plugins: {
          legend: { labels: { font: { size: 14 } } },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              title: function (items) {
                const date = new Date(items[0].parsed.x);
                const quarter = Math.floor(date.getMonth() / 3) + 1;
                return `${date.getFullYear()}: Q${quarter}`;
              }
            }
          }
        },
        interaction: { mode: 'nearest', intersect: false }
      },
      plugins: [recessionPlugin]
    });
  }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
    const target = document.getElementById(id);
    if (target) target.classList.add('active');

    history.replaceState(null, '', `?section=${id}`);

    if (id === 'results' && !timeChart) {
      setTimeout(() => createChart(), 50);
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const section = new URLSearchParams(location.search).get('section') || 'about';
    showSection(section);
  });

  window.addEventListener('popstate', (event) => {
    const section = event.state?.section || 'about';
    showSection(section);
  });
</script>

</body>
</html>
